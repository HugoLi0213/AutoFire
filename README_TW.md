# AutoFire - 自動連發工具

**作者:** Hugo  
**最後更新:** 2025-10-06

## 📋 簡介

AutoFire 是一個 Windows 自動按鍵工具，可以在您按住觸發鍵時自動重複發送指定的按鍵到目標視窗。

### ✨ 主要特性

- 🎮 **兩種輸出模式:**
  - **SendInput (建議):** 硬體級模擬，相容 DirectInput 遊戲（類似 AutoHotkey）
  - **PostMessage:** 視窗訊息佇列模擬，更安全但相容性較低
- 🪟 **視窗自動偵測:** 自動列出所有可見視窗供選擇
- ⌨️ **自訂按鍵:** 可自由設定觸發鍵和輸出鍵
- ⏱️ **可調間隔:** 1-1000 毫秒的重複間隔
- 🔄 **穿透模式:** 可選是否將觸發鍵傳遞到目標視窗
- 💾 **組態儲存:** 自動儲存和載入組態
- 🌐 **多語言介面:** 支援英文/繁體中文切換

## 🚀 快速開始

### 1️⃣ 安裝相依套件

```cmd
pip install keyboard
```

### 2️⃣ 執行程式

**以系統管理員身分執行**（鍵盤鉤子需要管理員權限）:

```cmd
python autofire_ui.py
```

### 3️⃣ 組態設定

1. **觸發鍵 (Trigger key):** 輸入您想用來啟動自動連發的按鍵（例如：`e`）
2. **輸出鍵 (Output key):** 輸入要自動重複發送的按鍵（例如：`r`）
3. **目標視窗 (Target Window Title):** 
   - 點擊 🔄 按鈕重新整理視窗清單
   - 從下拉選單選擇目標視窗
4. **間隔 (Interval):** 設定按鍵重複間隔（毫秒）
5. **穿透模式 (Pass-through):** 勾選則觸發鍵也會發送到視窗，不勾選則只觸發連發
6. **使用 SendInput (Use SendInput):** 
   - ✅ **勾選 (建議):** 使用硬體級模擬，相容 DirectInput 遊戲
   - ⬜ **不勾選:** 使用訊息佇列模擬，更安全但可能不相容某些遊戲
7. **語言 (Language):** 點擊右上角按鈕切換介面語言 (EN/繁中)

### 4️⃣ 開始使用

1. 點擊 **啟動 (Start)** 按鈕
2. 切換到目標視窗
3. 按住觸發鍵，程式將自動重複發送輸出鍵
4. 放開觸發鍵停止連發
5. 點擊 **停止 (Stop)** 按鈕停止監聽

### 📸 組態範例（跑跑卡丁車 Tale Runner）

![AutoFire 組態範例](docs/screenshot_tale_runner.png)

**預設設定:**
- 觸發鍵: `e`
- 輸出鍵: `e`
- 目標視窗: `Tales Runner`
- 間隔: `100 毫秒`
- 使用 SendInput: ✅ 已啟用（更好的遊戲相容性）

## 🎮 輸出模式說明

### SendInput 模式（預設，建議）

**優點:**
- ✅ 相容 DirectInput 遊戲（直接從鍵盤驅動讀取輸入的遊戲）
- ✅ 硬體級模擬，使用掃描碼 (Scan Codes)
- ✅ 與 AutoHotkey 相同的工作原理
- ✅ 適用於大多數遊戲

**工作原理:**
```
SendInput → 鍵盤驅動層 → DirectInput/遊戲
```

**何時使用:** 當遊戲忽略 PostMessage 時（大多數現代遊戲）

### PostMessage 模式（可選）

**優點:**
- ✅ 更安全，偵測風險更低
- ✅ 視窗特定目標（不會影響其他視窗）
- ✅ 常用於合法軟體（遠端桌面、輔助工具等）

**缺點:**
- ❌ 不相容 DirectInput 遊戲
- ❌ 某些遊戲會忽略訊息佇列輸入

**工作原理:**
```
PostMessage → 視窗訊息佇列 → 遊戲（如果遊戲讀取訊息佇列）
```

**何時使用:** 當您需要更安全的方案或目標是讀取訊息佇列的應用程式

## 🔧 支援的按鍵

常用按鍵包括:
- 字母鍵: `a`-`z`
- 數字鍵: `0`-`9`
- 功能鍵: `f1`-`f12`
- 特殊鍵: `space`, `enter`, `shift`, `ctrl`, `alt`, `tab`, `esc`
- 滑鼠: `left`, `right`, `middle` (滑鼠按鈕)

**注意:** 按鍵名稱不區分大小寫

## ⚙️ 組態檔

組態自動儲存到 `autofire.json`，格式如下:

```json
{
  "interval_ms": 50,
  "language": "zh_TW",
  "output_key": "r",
  "pass_through": false,
  "trigger_key": "e",
  "use_sendinput": true,
  "window_title": "未命名 - 記事本"
}
```

## 🛡️ 安全性說明

本應用程式使用 **合法的 Windows API 呼叫** 進行輸入模擬:

### ✅ 標準輸入模擬
- 使用 `SendInput()` 或 `PostMessageW()` API
- 與以下軟體使用相同的機制:
  - 遠端桌面軟體 (TeamViewer, RDP)
  - 輔助功能工具 (螢幕閱讀器、語音控制)
  - 巨集工具和自動化軟體

### ✅ 無記憶體干預
- **不** 讀取或寫入遊戲記憶體
- **不** 鉤取遊戲內部函式或注入程式碼 (DLL)
- 完全在遊戲處理程序外執行

### ✅ 降低偵測風險
- 從作業系統角度看，這些 API 輸入與合法軟體產生的輸入無法區分
- 反作弊系統不太可能封鎖這些 API，因為這樣會導致許多正常應用程式出現誤報

### ✅ 非侵入性
- 僅發送鍵盤事件，不修改任何遊戲檔案或處理程序

**重要提示:** 雖然本工具使用合法 API，但某些遊戲的服務條款可能禁止使用任何自動化工具。請自行承擔使用風險並遵守遊戲規則。

## 📝 使用範例

### 範例 1: 遊戲自動連發攻擊鍵
```
觸發鍵: e
輸出鍵: r
間隔: 50ms
目標視窗: MyGame.exe
穿透模式: ✅ 勾選
使用 SendInput: ✅ 勾選 (相容 DirectInput 遊戲)
```

**效果:** 按住 `E` 鍵時，每 50ms 自動發送 `R` 鍵到遊戲視窗，同時 `E` 鍵也會被遊戲接收

### 範例 2: 文字編輯器重複輸入
```
觸發鍵: f1
輸出鍵: space
間隔: 100ms
目標視窗: Notepad
穿透模式: ⬜ 不勾選
使用 SendInput: ⬜ 不勾選 (PostMessage 足夠)
```

**效果:** 按住 `F1` 時，每 100ms 自動在記事本中輸入空格，`F1` 不會傳遞到記事本

## ❓ 常見問題

### Q: 為什麼需要系統管理員權限？
A: Windows 的全域鍵盤鉤子 (keyboard hook) 需要系統管理員權限才能監聽按鍵事件。

### Q: 某些遊戲不工作怎麼辦？
A: 確保勾選 "使用 SendInput (AHK 風格，更好的遊戲相容性)" 核取方塊。SendInput 相容 DirectInput 遊戲，而 PostMessage 不相容。

### Q: SendInput 和 PostMessage 有什麼區別？
A:
- **SendInput:** 硬體級模擬，相容 DirectInput 遊戲，與 AutoHotkey 相同
- **PostMessage:** 訊息佇列模擬，更安全但某些遊戲會忽略

### Q: 會被反作弊系統偵測嗎？
A: 本工具使用合法的 Windows API（SendInput/PostMessage），與遠端桌面、AutoHotkey 等軟體相同。但某些遊戲可能仍會偵測到自動化行為。請自行評估風險。

### Q: 組態儲存在哪裡？
A: 組態自動儲存在與程式相同目錄的 `autofire.json` 檔案中。

### Q: 支援哪些按鍵？
A: 支援大多數常用按鍵。請參閱上方的「支援的按鍵」部分。鍵名來自 Python `keyboard` 函式庫。

### Q: 如何切換介面語言？
A: 點擊視窗右上角的語言切換按鈕（EN/繁中），介面會立即切換語言並儲存您的偏好設定。

## 🔍 故障排除

### 程式無法啟動
- 確保以系統管理員身分執行
- 檢查是否安裝了 `keyboard` 函式庫: `pip install keyboard`

### 按鍵沒有回應
- 確認目標視窗標題正確（點擊 🔄 重新整理視窗清單）
- 檢查觸發鍵和輸出鍵是否正確
- 嘗試切換 SendInput/PostMessage 模式

### 遊戲忽略輸入
- ✅ 勾選 "使用 SendInput" 核取方塊
- 確保遊戲視窗在前景且有焦點
- 某些遊戲可能有輸入保護，無法繞過

## 📄 授權

本專案為教育和個人使用目的。請遵守您所使用的遊戲或應用程式的服務條款。

## 👤 作者

**Hugo**  
專案儲存庫: [github.com/HugoLi0213/Marcoapp](https://github.com/HugoLi0213/Marcoapp)

---

**最後更新:** 2025年10月6日
